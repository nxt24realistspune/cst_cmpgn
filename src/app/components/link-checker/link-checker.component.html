<div class="link-checker-container">
  <!-- Header with Logo -->
  <div class="header-section">
    <div class="logo-container">
      <!-- Mail Polish Logo -->
      <img class="logo-icon" src="/assets/MPLogo.png" />
      <div class="logo-text">
        <h1 class="brand-name">MailPolish</h1>
        <p class="brand-tagline">Perfect Every Send</p>
      </div>
    </div>

    <!-- Navigation Links -->
    <div class="nav-links">
      <a
        routerLink="/qa-platform"
        style="color: white !important; font-weight: bold !important"
        routerLinkActive="active"
        class="nav-link"
        >QA Platform</a
      >
      <a
        routerLink="/link-checker"
        style="color: white !important; font-weight: bold !important"
        routerLinkActive="active"
        class="nav-link"
        >Link Checker</a
      >
    </div>
  </div>

  <!-- Main Content -->
  <div class="content-wrapper">
    <div class="page-title-section">
      <div class="section-icon link-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
          />
        </svg>
      </div>
      <div>
        <h2 class="page-title">Link Checker</h2>
        <p class="page-subtitle">Validate all links in your HTML email</p>
      </div>
    </div>

    <!-- Upload Section -->
    <div class="upload-section-wrapper">
      <div class="section-header">
        <div class="section-icon check-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"
            />
          </svg>
        </div>
        <div class="section-title-group">
          <h3 class="section-title">HTML File</h3>
          <p class="section-subtitle">Upload your HTML email file</p>
        </div>
      </div>

      <div class="upload-card" [class.has-file]="selectedFile">
        <input
          type="file"
          id="htmlFile"
          class="file-input"
          accept=".html"
          (change)="onFileSelected($event)"
          #fileInput
        />

        <label for="htmlFile" class="upload-label" *ngIf="!selectedFile">
          <div class="upload-icon-wrapper">
            <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
              />
            </svg>
          </div>
          <span class="upload-text"
            >Drop your HTML file here or <span class="upload-link">browse</span></span
          >
          <span class="upload-formats">Supports: HTML files only</span>
        </label>

        <div *ngIf="selectedFile" class="file-preview">
          <div class="file-icon html-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"
              />
            </svg>
          </div>
          <div class="file-details">
            <span class="file-name">{{ selectedFile.name }}</span>
            <span class="file-size">{{ formatFileSize(selectedFile.size) }}</span>
          </div>
          <button class="remove-btn" (click)="removeFile()" type="button">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Action Button -->
    <div class="action-section">
      <button
        class="check-btn"
        [disabled]="!selectedFile || loading"
        [class.processing]="loading"
        (click)="checkLinks()"
        type="button"
      >
        <svg
          *ngIf="!loading"
          class="btn-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
          />
        </svg>
        <div *ngIf="loading" class="spinner"></div>
        <span *ngIf="!loading">Check Links</span>
        <span *ngIf="loading">Checking...</span>
      </button>
    </div>

    <!-- Error Message -->
    <div *ngIf="error" class="error-card">
      <div class="error-content">
        <h4 class="error-title">Error</h4>
        <p class="error-message">{{ error }}</p>
      </div>
    </div>

    <!-- Response Section -->
    <!-- use Angular's keyvalue pipe to iterate an object whose keys are URLs and values are status codes -->
    <ul class="link-list">
      <li *ngFor="let item of response?.final_generated_response| keyvalue" class="link-item">
        <!-- link (clickable) -->
        <a [href]="item.key" target="_blank" rel="noopener noreferrer" class="link">{{
          item.key
        }}</a>

        <!-- status: show tick for 200, cross otherwise -->
        <span
          class="status"
          [attr.title]="'HTTP ' + item.value"
          [class.ok]="item.value === 200"
          [class.err]="item.value !== 200"
          aria-live="polite"
        >
          <!-- green tick -->
          <svg
            *ngIf="item.value === 200"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path fill="currentColor" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z" />
          </svg>

          <!-- red cross -->
          <svg
            *ngIf="item.value !== 200"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              fill="currentColor"
              d="M18.3 5.7 12 12l6.3 6.3-1.4 1.4L10.6 13.4 4.3 19.7 2.9 18.3 9.2 12 2.9 5.7 4.3 4.3 10.6 10.6 17 4.3z"
            />
          </svg>

          <!-- optional numeric display -->
          <small class="code"> {{ item.value }}</small>
        </span>
      </li>
    </ul>
  </div>
</div>
